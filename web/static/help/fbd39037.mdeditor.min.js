/*! zybuluo */
com.zybuluo.mdeditor.unifiedEditor=function(){function a(){window.lightMode||(e.renderer.setPadding(15),f[0].style.fontSize="16px",f[0].style.lineHeight="27px",f[0].style.fontFamily='Menlo, Ubuntu Mono, Consolas, "Courier New", Microsoft Yahei, Hiragino Sans GB, WenQuanYi Micro Hei, sans-serif')}function b(a,b){var c=require("ace/config");c.loadModule("ace/ext/searchbox",function(c){c.Search(a,b)}),$(".ace_search_form .ace_search_field").attr("placeholder","查找"),$(".ace_replace_form .ace_search_field").attr("placeholder","替换成");var d=$(".ace_replace_form .ace_replacebtn");$(d[0]).text("替换"),$(d[1]).text("所有");var e=$(".ace_search_options span");$(e[0]).attr("title","按正则表达式查找"),$(e[1]).attr("title","大小写敏感"),$(e[2]).attr("title","查找完整单词")}function c(){e=ace.edit("wmd-input"),e.setOption("spellcheck",!0),e.setOption("scrollPastEnd",!0),e.renderer.setShowGutter(!1),e.renderer.setPrintMarginColumn(!1),e.session.setUseWrapMode(!0),e.session.setNewLineMode("unix"),e.setTheme("ace/theme/dawn");var c=require("ace/mode/markdown").Mode;return e.getSession().setMode(new c),e.session.$selectLongWords=!0,a(),e.setKeyboardHandler(""),e.commands.addCommands([{name:"Find",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(a){b(a,!1)},readOnly:!0},{name:"Replace",bindKey:{win:"Ctrl-Shift-F",mac:"Command-Option-F"},exec:function(a){b(a,!0)},readOnly:!0}]),e}var d,e,f;if(window.lightMode)d=$("#wmd-input"),f=d,d.tabHandler();else{f=$("#wmd-input");var g=f.val();if(""===g)return void window.location.reload();f.replaceWith('<div style="display:none" class="wmd-input theme" id="wmd-input"></div>'),f=$("#wmd-input"),e=c(),e.setValue(g,-1);var h=e.getSession().getUndoManager();h.reset(),e.getSession().setUndoManager(h),f.css("display","block")}var i={setValue:function(a){window.lightMode?d.val(a):e.setValue(a,-1)},getValue:function(){return window.lightMode?d.val():e.getValue()},focus:function(){window.lightMode?d.focus():e.focus()},getEditor:function(){return window.lightMode?d:e},getWmdInput:function(){return f},restoreAceEditor:a,applyTheme:function(a){window.lightMode||e.setTheme("theme-black"===a?"ace/theme/tomorrow_night_eighties":"ace/theme/dawn")},applyMode:function(a){window.lightMode||(e.setKeyboardHandler("vim"===a?"ace/keyboard/vim":"emacs"===a?"ace/keyboard/emacs":""),e.focus())},searchEditor:function(a){window.lightMode||b(e,a)}};return i}(),com.zybuluo.mdeditor.fileManager=function(){function a(a){l().isEditorReader&&(a?($("#preview-published-button").show(),$("#preview-publish-button").hide(),$("#preview-published-td").show(),$("#preview-publish-td").hide()):($("#preview-publish-button").show(),$("#preview-published-button").hide(),$("#preview-publish-td").show(),$("#preview-published-td").hide())),m.isPublic=a?"True":"False"}function b(b,c,d,e){parentATag=$("ul#file-list span.whiter-on-black").parent("a"),c===!0?(parentATag.attr("title","【已发布】 "+d),parentATag.find("i").removeClass().addClass("icon-share-sign"),a(c)):(parentATag.attr("title","【未发布】 "+d),parentATag.find("i").removeClass().addClass("icon-share"),a(c));var f=$(".article-updated-date");0!==f.length&&f.each(function(){$(this).html(d)}),m.currentId=String(b),m.currentVersionId=String(e)}function c(a){var b=$("#file-list .whiter-on-black").first().parent("a").parent("li"),c=b.siblings(".tag-item"),d=[];$("#file-list .tag-item").each(function(){var c=$(this).attr("tag-name"),e=$(this).children(".tag-count"),f=$(this).parent("ul.tag-list"),g=f.find(".whiter-on-black"),h=0!==g.length;if(-1!==a.indexOf(c)){if(!h){var i=null;$(this).nextAll().each(function(){return b.attr("file-created-date")>$(this).attr("file-created-date")?(i=$(this),!1):void 0}),null===i?f.append(b.clone()):i.before(b.clone()),e.text(Number(e.text())+1)}d.push(c)}else h&&(1===$(this).siblings().length?$(this).parent("ul.tag-list").parent("li").remove():(g.parent("a").parent("li").remove(),e.text(Number(e.text())-1)))});var e=function(a){var b=null;return $("#file-list .tag-item").each(function(){return a<$(this).attr("tag-name")?(b=$(this),!1):void 0}),b},f=$("#file-list");for(var g in a){var h=a[g];if(-1===d.indexOf(h)){var i=$('<li><ul class="tag-list"></ul></li>');i.find(".tag-list").append(c.clone()),i.find(".tag-name").text(h),i.find(".tag-count").text("1"),i.find(".tag-item").attr("tag-name",h).after(b.clone());var j=e(h);null===j?f.append(i):j.parent("ul").parent("li").before(i)}}}function d(a,b){o(a,b,function(){window.location=m.loginComeFromUrl})}function e(){var a="新建文稿",b="【新建文稿】需要用户登录，现在登录？";return"True"!==m.isLoggedIn?void d(a,b):(b="当前文稿内容已保存至云端，确认新建文稿？",void o(a,b,function(){$("#notification").find(".modal-body p").html("正在提交您的请求......"),$.post(m.newUserNoteUrl,{},function(a){a.loggedin===!1?($("#notification").modal("hide"),window.location=m.loginComeFromUrl):a.id&&a.version_id?($("#notification").modal("hide"),window.location=a.newUrl+window.location.hash):a.error&&$("#notification").find(".modal-body p").html('出错啦，请 <a href="javascript:window.location.reload();void 0;">刷新</a> 页面后重试')},"json")}))}function f(){var a="删除文稿",b="【删除文稿】需要用户登录，现在登录？";if("True"!==m.isLoggedIn)return void d(a,b);var c=$("ul#file-list span#"+m.currentId).text();b="删除不可撤销，确认删除【<strong>"+c+"</strong>】？",o(a,b,function(){$("#notification").find(".modal-body p").html("正在提交您的请求......"),$.post(m.deleteUserNoteUrl,{id:m.currentId,version_id:m.currentVersionId},function(a){a.loggedin===!1?($("#notification").modal("hide"),window.location=m.loginComeFromUrl):a.userNoteUrl?($("#notification").modal("hide"),window.location=a.userNoteUrl):a.version_error===!0?$("#notification").find(".modal-body p").html('文稿已在别处被更新，请 <a href="javascript:window.location.reload();void 0;">刷新</a> 页面后重试'):a.error&&$("#notification").find(".modal-body p").html('出错啦，请 <a href="javascript:window.location.reload();void 0;">刷新</a> 页面后重试')},"json")})}function g(a,b){var c="导出文稿",e="【导出文稿】需要用户登录，现在登录？";if("True"!==m.isLoggedIn)return void d(c,e);var f=$("ul#file-list span#"+m.currentId).text();if("markdown"===a)n(b,f+".markdown");else if("html"==a){var g='<!DOCTYPE html>\n<html>\n<head>\n<meta charset="utf-8">\n<title>'+f+"</title>\n</head>\n<body>\n"+$("#wmd-preview").html()+"\n</body>\n</html>";n(g,f+".html")}}function h(a,c){o(a,c,function(){$("#notification").find(".modal-body p").html("正在提交您的请求......");var a=$("#wmd-preview"),c=a.html(),d=com.zybuluo.mdeditor.common.caculatePreviewCharacters();$.post(m.publishUserNoteUrl,{id:m.currentId,version_id:m.currentVersionId,preview:c,is_public:!0,chars_count:d},function(a){if(a.loggedin===!1)$("#notification").modal("hide"),window.location=m.loginComeFromUrl;else if(a.id&&a.version_id){b(a.id,a.is_public,a.updated_date,a.version_id);var c=m.userNoteUrl;$("#notification").find(".modal-body p").html('发布成功！本文固定链接：<a href="'+c+'" target="_blank">'+c+"</a>，欢迎分享至社交网络"),$("#notification-cancel").hide(),$("#notification-confirm").data("operation",function(){$("#notification").modal("hide"),$("#notification-cancel").show()})}else a.version_error===!0?$("#notification").find(".modal-body p").html('文稿已在别处被更新，请 <a href="javascript:window.location.reload();void 0;">刷新</a> 页面后重试'):a.error&&("no preview"===a.error?($("#notification").find(".modal-body p").html("不能发布空白内容，请撰写内容后再发布"),$("#notification-confirm").data("operation",function(){$("#notification").modal("hide")})):$("#notification").find(".modal-body p").html('出错啦，请 <a href="javascript:window.location.reload();void 0;">刷新</a> 页面后重试'))},"json")})}function i(){var a="发布文稿",b="【发布文稿】需要用户登录，现在登录？";if("True"!==m.isLoggedIn)return void d(a,b);var c=$("ul#file-list span#"+m.currentId).text();b="发布文稿后您的稿件可以被他人访问分享，确认发布【<strong>"+c+"</strong>】？",h(a,b)}function j(){var a="发布更新",b="【发布更新】需要用户登录，现在登录？";if("True"!==m.isLoggedIn)return void d(a,b);var c=$("ul#file-list span#"+m.currentId).text();b="文稿发布后，如果您对稿件进行了修改更新，可以再次发布更新后的内容到固定链接，确认发布更新【<strong>"+c+"</strong>】？",h(a,b)}function k(){var a="撤销发布",c="【撤销发布】需要用户登录，现在登录？";if("True"!==m.isLoggedIn)return void d(a,c);var e=$("ul#file-list span#"+m.currentId).text();c="撤销发布后您的文稿只能被自己所见，确认撤销发布【<strong>"+e+"</strong>】？",o(a,c,function(){$("#notification").find(".modal-body p").html("正在提交您的请求......"),$.post(m.publishUserNoteUrl,{id:m.currentId,version_id:m.currentVersionId,preivew:null,is_public:!1},function(a){a.loggedin===!1?($("#notification").modal("hide"),window.location=m.loginComeFromUrl):a.id&&a.version_id?($("#notification").modal("hide"),b(a.id,a.is_public,a.updated_date,a.version_id)):a.version_error===!0?$("#notification").find(".modal-body p").html('文稿已在别处被更新，请 <a href="javascript:window.location.reload();void 0;">刷新</a> 页面后重试'):a.error&&$("#notification").find(".modal-body p").html('出错啦，请 <a href="javascript:window.location.reload();void 0;">刷新</a> 页面后重试')},"json")})}var l=com.zybuluo.mdeditor.common.getCurrentMode,m=com.zybuluo.mdeditor.initData,n=(com.zybuluo.common.pushState,com.zybuluo.mdeditor.common.saveAs),o=com.zybuluo.common.popupConfirm;return{switchPublishButton:a,reset_file_public_changes:b,reset_tag_changes:c,newFile:e,deleteFile:f,downloadFile:g,publishFile:i,republishFile:j,publishedFile:k}}(),com.zybuluo.mdeditor.scrollLink=function(){var a,b=com.zybuluo.mdeditor.unifiedEditor,c={extensionId:"scrollLink",extensionName:"Scroll Link",optional:!0,settingsBloc:["<p>Binds together editor and preview scrollbars.</p>",'<blockquote class="muted"><b>NOTE:</b>',"   The mapping between Markdown and HTML is based on the position of the title elements (h1, h2, ...) in the page.","   Therefore, if your document does not contain any title, the mapping will be linear and consequently less accurate.","</bloquote>"].join("")},d=window.lightMode?null:b.getEditor();c.onSectionsCreated=function(b){a=b};var e=0;c.onMarkdownTrim=function(a){e=a};var f,g,h,i=[],j=[],k=-10,l=-10,m=_.debounce(function(b){function c(a){var b=r;if(void 0!==a){var c=document.createTextNode(a);g.empty().append(c),b+=g.prop("scrollHeight")}var d=p+b;i.push({startOffset:p,endOffset:d,height:b,length:void 0===a?0:a.length+1}),p=d}i=[];var m=0,p=0,q=e,r=0;if(window.lightMode){g.innerWidth(f.innerWidth()),_.each(a,function(b,d){var e=b.text;d!==a.length-1?0===e.length&&(e=void 0):/\n$/.test(e)&&(e+="\n"),c(e)});var t=_.last(i).endOffset,u=f[0].scrollHeight,v=u/t;i=_.map(i,function(a){return{startOffset:a.startOffset*v,endOffset:a.endOffset*v,height:a.height*v,length:a.length}})}else _.each(a,function(a){m+=a.text.length+q,q=0;var b=d.session.doc.indexToPosition(m),c=d.session.documentToScreenPosition(b.row,b.column),e=c.row*d.renderer.lineHeight,f=e-p;i.push({startOffset:p,endOffset:e,height:f,length:void 0===a.text?0:a.text.length+1}),p=e});j=[];var w,x=h.scrollTop(),y=h.position().top;h.find("#wmd-preview > .md-section-divider").each(function(){if(void 0===w)return void(w=0);var a=$(this),b=a.position().top-y+x;j.push({startOffset:w,endOffset:b,height:b-w}),w=b});var z=h.prop("scrollHeight");j.push({startOffset:w,endOffset:z,height:z-w}),k=-10,l=-10,b===!0?n=!0:b===!1?o=!0:(null===b||void 0===b)&&(n=!0),s()},500),n=!1,o=!1,p=!1,q=!1,r=$("<div>"),s=_.throttle(function(){function a(a,b,c){var d,e=_.find(b,function(b,c){return d=c,a<b.endOffset});if(void 0!==e){var f=(a-e.startOffset)/(e.height||1),g=c[d];return g.startOffset+g.height*f}}if(0===i.length||i.length!==j.length)return void s();var b=window.lightMode?f.scrollTop():d.renderer.getScrollTop();0>b&&(b=0);var c,e=h.scrollTop();if(n===!0){if(Math.abs(b-k)<=9)return;if(n=!1,k=b,c=a(b,i,j),c=_.min([c,h.prop("scrollHeight")-h.outerHeight()]),Math.abs(c-e)<=9)return void(l=e);r.stop("scrollLinkFx",!0).css("value",0).animate({value:c-e},{duration:200,queue:"scrollLinkFx",step:function(a){q=!0,l=e+a,h.scrollTop(l)},done:function(){_.defer(function(){q=!1,v=!1})}}).dequeue("scrollLinkFx")}else if(o===!0){if(Math.abs(e-l)<=9)return;if(o=!1,l=e,c=a(e,j,i),window.lightMode?c=_.min([c,f.prop("scrollHeight")-f.outerHeight()]):(c=_.min([c,d.session.getScreenLength()*d.renderer.lineHeight+d.renderer.scrollMargin.bottom-d.renderer.$size.scrollerHeight]),0>c&&(c=0)),Math.abs(c-b)<=9)return void(k=b);r.stop("scrollLinkFx",!0).css("value",0).animate({value:c-b},{duration:200,queue:"scrollLinkFx",step:function(a){p=!0,k=b+a,window.lightMode?f.scrollTop(k):d.session.setScrollTop(k)},done:function(){_.defer(function(){p=!1,v=!1})}}).dequeue("scrollLinkFx")}},100);c.buildSections=function(){m(!0)};var t=!1;c.onLayoutCreated=function(){h=$(".preview-container"),f=$("#wmd-input"),g=$("#md-section-helper"),h.scroll(function(){q===!1&&t===!1&&(o=!0,n=!1,s()),t=!1});var a=function(){p===!1&&(n=!0,o=!1,s())};window.lightMode?f.scroll(a):d.session.on("changeScrollTop",a)};var u;c.onEditorConfigure=function(a){u=$("#wmd-preview"),a.getConverter().hooks.chain("postConversion",function(a){return u.height(u.height()),a});var b="^.+[ \\t]*\\n=+[ \\t]*\\n+|^.+[ \\t]*\\n-+[ \\t]*\\n+|^\\#{1,6}[ \\t]*.+?[ \\t]*\\#*\\n+";b="^```.*\\n[\\s\\S]*?\\n```|"+b,b="^[ \\t]*\\n\\$\\$[\\s\\S]*?\\$\\$|"+b,b="^[ \\t]*\\n\\\\\\\\[[\\s\\S]*?\\\\\\\\]|"+b,b="^[ \\t]*\\n\\\\?\\\\begin\\{[a-z]*\\*?\\}[\\s\\S]*?\\\\end\\{[a-z]*\\*?\\}|"+b,b=new RegExp(b,"gm");var d=a.getConverter();d.hooks.chain("preConversion",function(a){function d(a,b){var c=e.substring(g,b);f.push({text:c,textWithDelimiter:'\n<div class="md-section-divider"></div>\n\n'+c+"\n"})}var e=a+"\n\n",f=[],g=0;return e.replace(b,function(a,b){d(g,b),g=b}),d(g,a.length),c.onSectionsCreated(f),_.reduce(f,function(a,b){return a+b.textWithDelimiter},"")})};var v=!0;return c.onPreviewFinished=function(){var a=u.height();u.height("auto");var b=u.height();a>b&&(t=!0),m(v===!0?!1:!0)},c.getCursorPositionForPageDownUpInFullEditorMode=function(a){var b,c=_.find(i,function(c,d){return b=d,a<c.endOffset});if(void 0===c)return-1;for(var d=0,e=0;b>=e;e++)d+=i[e].length;return d},c}(),com.zybuluo.mdeditor.toc=function(){function a(a,b,c){this.tagName=a,this.anchor=b,this.text=c,this.children=[]}function b(c,d){function e(){void 0!==g&&(g.children.length>0&&(g.children=b(g.children,d+1)),i.push(g))}d=d||1;var g,h="H"+d,i=[];return _.each(c,function(b){b.tagName!=h?d!==f&&(void 0===g&&(g=new a),g.children.push(b)):(e(),g=b)}),e(),i}function c(a){return a.toLowerCase().replace(/\s/g,"-").replace(h,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")}function d(){function d(a){for(var b=a.id||c(a.textContent)||"title",d=b,f=0;_.has(e,d);)d=b+"-"+ ++f;return e[d]=!0,a.id=d,d}var e={},f=[];return _.each(g.querySelectorAll("h1, h2, h3, h4, h5, h6"),function(b){f.push(new a(b.tagName,d(b),b.textContent))}),f=b(f),'<div class="toc">\n<ul>\n'+f.join("")+"</ul>\n</div>\n"}var e="\\[(TOC|toc)\\]",f=6;a.prototype.childrenToString=function(){if(0===this.children.length)return"";var a="<ul>\n";return _.each(this.children,function(b){a+=b.toString()}),a+="</ul>\n"},a.prototype.toString=function(){var a="<li>";return this.anchor&&this.text&&(a+='<a href="#'+this.anchor+'">'+this.text+"</a>"),a+=this.childrenToString()+"</li>\n"};var g,h=XRegExp("[^\\p{L}\\p{N}-]","g");g=document.getElementById("wmd-preview");var i=new RegExp("^"+e+"$"),j=function(){var a=document.querySelectorAll(".table-of-contents, .toc"),b=d();_.each(g.getElementsByTagName("p"),function(a){i.test(a.innerHTML)&&(a.innerHTML=b)}),_.each(a,function(a){a.innerHTML=b})};return{renderToc:j}}(),com.zybuluo.mdeditor.mode=function(){function a(){if(e().isFullReader&&0===$("#editor-reader-full").has("#wmd-preview").length){$("#editor-reader-full").html("");var a=$("#reader-full-topInfo").clone().removeClass("reader-full-topInfo-hidden").addClass("reader-full-topInfo-shown");$("#editor-reader-full").append(a),$("#editor-reader-full").append($(".in-page-preview-buttons").addClass("in-page-preview-buttons-full-reader")),$("#editor-reader-full").append($("#wmd-preview").addClass("wmd-preview-full-reader").focus())}}var b=com.zybuluo.mdeditor.unifiedEditor,c=com.zybuluo.mdeditor.scrollLink,d=(com.zybuluo.mdeditor.initData,com.zybuluo.mdeditor.common.buttonBinding),e=com.zybuluo.mdeditor.common.getCurrentMode,f=com.zybuluo.mdeditor.common.initialHiddenSideToolBar,g=com.zybuluo.mdeditor.common.colorWmdButtons,h=b.getWmdInput(),i=function(){window.location.hash="#full-editor",n(),$("#container").hide(),$("#editor-reader-full").removeClass("editor-reader-full-hidden").addClass("editor-reader-full-shown"),$("#wmd-editor-small-button").show(),$("#wmd-editor-full-button").hide(),window.lightMode&&h.keydown(function(a){var b=null,d=$(window).height()-$("#wmd-panel-editor").position().top,e=parseInt($(this).css("line-height"),10);d-=2*e;var f=$("#wmd-panel-editor").scrollTop();if(33===a.keyCode&&(b=f-d),34===a.keyCode&&(b=f+d),null!==b){$("#wmd-panel-editor").animate({scrollTop:b},1);var g=c.getCursorPositionForPageDownUpInFullEditorMode(b);if(-1!=g){var i=h.val().length;g>i&&(g=i),h.setCursorPosition(g),a.preventDefault()}}}),g(),$("#editor-reader-full").append($("#wmd-button-bar").removeClass().addClass("wmd-button-bar-full-shown")),$("#editor-reader-full").append(window.lightMode?$("#wmd-panel-editor").removeClass().addClass("wmd-panel-editor-full-shown"):$("#wmd-panel-editor").removeClass().addClass("wmd-panel-editor-full-shown-ace")),$("#wmd-panel-editor").prepend($(".in-page-editor-buttons")),m(),window.lightMode?(h.css("max-width","850px").focus(),$("#md-section-helper").attr("style","max-width:850px; overflow:hidden; word-wrap:break-word; resize: none;")):b.focus(),$(window).unbind("resize");var a=null;a=window.lightMode?function(){h.autosize(),h.trigger("autosize.resize"),$("#wmd-panel-editor").height($(window).height()-$("#wmd-panel-editor").position().top),$(".in-page-editor-buttons").css("margin-left",h.position().left+h.width()-125)}:function(){var a=$(window).width();h.width(a-15);var c=a>=850?(a-850)/2:0;b.getEditor().renderer.setPadding(c);var d=$(window).height()-$("#wmd-panel-editor").position().top;h.height(d),b.getEditor().resize(),$(".in-page-editor-buttons").css("margin-left",c+850-125)},$(window).resize(function(){a()}),$(window).resize()},j=function(a){window.location.hash="",window.lightMode&&h.unbind("keydown"),g(),$("#wmd-button-bar").removeClass().addClass("wmd-button-bar"),$("#wmd-panel-editor").removeClass().addClass("wmd-panel-editor"),$("#editor-column").append($("#wmd-button-bar")),$("#editor-column").append($(".in-page-editor-buttons")),$("#editor-column").append($("#wmd-panel-editor")),m(),window.lightMode?($("#md-section-helper").removeAttr("style"),h.trigger("autosize.destroy"),h.removeAttr("style")):(h.removeAttr("style"),b.restoreAceEditor(),b.getEditor().resize()),$("#wmd-panel-editor").removeAttr("style"),$("#wmd-editor-small-button").hide(),$("#wmd-editor-full-button").show(),$("#editor-reader-full").removeClass("editor-reader-full-shown").addClass("editor-reader-full-hidden"),$("#container").show(),a()},k=function(){com.zybuluo.mdeditor.common.caculateAndFillPreviewCharacters(),h.blur(),window.location.hash="#full-reader",$("#container").hide(),$("#editor-reader-full").removeClass("editor-reader-full-hidden").addClass("editor-reader-full-shown"),$("#editor-reader-full").css("position","static"),$("#preview-reader-small-button").show(),$("#preview-reader-full-button").hide(),$("#preview-column li.editor-only").hide();var b=$("#preview-theme-button").removeClass("in-page-button").addClass("preview-button"),c=$("#preview-reader-full-button").removeClass("in-page-button").addClass("preview-button"),e=$("#preview-reader-small-button").removeClass("in-page-button").addClass("preview-button"),g=$("#preview-fullscreen-button").removeClass("in-page-button").addClass("preview-button");d(".preview-button > span","#F9F9F5","#BBBBBB"),0!==$("#preview-button-row #preview-list-button").length?$("#preview-button-row #preview-list-button").after(g).after(e).after(c).after(b):$("#preview-button-row").prepend(g).prepend(e).prepend(c).prepend(b),$("#reader-full-toolbar").removeClass("reader-full-toolbar-hidden").addClass("reader-full-toolbar-shown"),$("#reader-full-toolbar").append($("#preview-button-row").removeClass("pull-left pull-right")),$("#reader-full-toolbar-tail").removeClass("reader-full-toolbar-tail-hidden").addClass("reader-full-toolbar-tail-shown"),$("#file-list, #about-menu").removeClass("pull-left pull-right").addClass("pull-right"),a(),$("#preview-button-row > li:visible").css("display","block"),$("#preview-button-row > li:visible").removeClass("preview-button").addClass("preview-button-full-reader"),f.hideToolBarForMobile(),$(window).unbind("resize"),$(window).resize(function(){com.zybuluo.mdeditor.common.resetMaxHeightOfFileList()}),$(window).resize()},l=function(a){window.location.hash="",f.isHidden()&&f.hideToolBar(),$("#preview-button-row > li:visible").removeAttr("style"),$("#preview-button-row > li:visible").removeClass("preview-button-full-reader").addClass("preview-button"),$("#preview-button-row > li.wmd-spacer:visible").removeClass("preview-button"),$("#wmd-panel-preview").before($(".in-page-preview-buttons").removeClass("in-page-preview-buttons-full-reader")),$("#wmd-panel-preview").append($("#wmd-preview").removeClass("wmd-preview-full-reader"));var b=q.isExchanged(),c="pull-right";b&&(c="pull-left"),$("#preview-button-bar").prepend($("#preview-button-row").addClass(c)),$("#file-list, #about-menu").removeClass("pull-left pull-right").addClass(c),$("#reader-full-toolbar").removeClass("reader-full-toolbar-shown").addClass("reader-full-toolbar-hidden"),$("#reader-full-toolbar-tail").addClass("reader-full-toolbar-tail-hidden").addClass("reader-full-toolbar-tail-shown"),$("#preview-column li.editor-only").show();var d=$("#preview-theme-button").removeClass("preview-button").addClass("in-page-button"),e=$("#preview-reader-full-button").removeClass("preview-button").addClass("in-page-button"),g=$("#preview-reader-small-button").removeClass("preview-button").addClass("in-page-button"),h=$("#preview-fullscreen-button").removeClass("preview-button").addClass("in-page-button");m(),$(".in-page-preview-buttons > ul").append(d).append(e).append(g).append(h),$(".in-page-preview-buttons").removeClass("in-page-preview-buttons-full-reader"),$("#preview-reader-small-button").hide(),$("#preview-reader-full-button").show(),$("#editor-reader-full").html(""),$("#editor-reader-full").removeAttr("style"),$("#editor-reader-full").removeClass("editor-reader-full-shown").addClass("editor-reader-full-hidden"),$("#container").show(),a()},m=function(){$("body").hasClass("theme-black")?d(".in-page-button > span","rgba(249, 249, 245, 0.65)","rgb(187, 187, 187, 0.45)"):d(".in-page-button > span","rgba(44, 62, 80, 0.65)","rgba(102, 128, 153, 0.45)")},n=function(){$("#article-loading-alert").hasClass("article-loading-alert-hidden")||($("#article-loading-alert").removeAttr("style"),$("#article-loading-alert").addClass("article-loading-alert-hidden"))},o=function(a){if(a&&(e().isFullReader||e().isEditorReader)){var b=0;if(e().isEditorReader){var c=$("#wmd-preview");b=c.position().left+c.width()/2-150}else b=$(window).width()/2-150;var d=$(window).height()/2-50;$("#article-loading-alert").removeClass("article-loading-alert-hidden").css("position","fixed").css("z-index",5e3).css("left",b+"px").css("top",d+"px")}},p=function(){var a=!1,b=function(){a?($("#wmd-button-bar").show(),$("#preview-button-bar").show(),a=!1):($("#wmd-button-bar").hide(),$("#preview-button-bar").hide(),a=!0)};return{hideToolBar:b,isHidden:function(){return a}}}(),q=function(){var a=!1,b=function(){a?($("#editor-column").removeClass("pull-right").addClass("pull-left"),$("#preview-column").removeClass("pull-left").addClass("pull-right"),$("#preview-button-row").removeClass("pull-left").addClass("pull-right"),$("ul.dropdown-menu.pull-left").removeClass("pull-left").addClass("pull-right"),$("#editor-reader-exchange-button span").removeClass("icon-chevron-sign-right").addClass("icon-chevron-sign-left"),a=!1):($("#editor-column").removeClass("pull-left").addClass("pull-right"),$("#preview-column").removeClass("pull-right").addClass("pull-left"),$("#preview-button-row").removeClass("pull-right").addClass("pull-left"),$("ul.dropdown-menu.pull-right").removeClass("pull-right").addClass("pull-left"),$("#editor-reader-exchange-button span").removeClass("icon-chevron-sign-left").addClass("icon-chevron-sign-right"),a=!0),$.localStorage("isEditorPreviewExchanged",a)},c=function(){var a=$.localStorage("isEditorPreviewExchanged");a||(a=!1),a&&b()};return{exchange:b,loadDefault:c,isExchanged:function(){return a}}}();return{switchFullEditorMode:i,switchNormalModeFromFullEditorMode:j,fillUpFullReaderMode:a,switchFullReaderMode:k,switchNormalModeFromFullReaderMode:l,openArticleLoadingAlert:o,closeArticleLoadingAlert:n,initialHiddenTopToolBar:p,exchangeEditorPreview:q}}(),com.zybuluo.mdeditor.init=function(a){function b(a){var b=!1;if(q.length!==a.length)b=!0;else for(var c in q)if(-1===a.indexOf(q[c])){b=!0;break}return b&&(q=a,f.reset_tag_changes(q),u===!1&&(r===!1?(r=!0,$("#file-list-topbar").css("display","block"),$("#file-list").css("display","block"),$("#search-file-bar").css("display","none"),$("#tag-file-bar").css("display","block")):clearTimeout(s),$("#file-list .tag-item:visible").hide(),$("#file-list .file-item:visible").hide(),$("#file-list .whiter-on-black").parent("a").parent("li").siblings(".tag-item").show(),s=setTimeout(function(){$("#file-list-topbar").css("display",""),$("#file-list").css("display",""),$("#search-file-bar").css("display","block"),$("#tag-file-bar").css("display","none"),r=!1},3e3))),b}function c(a,b,c,d){y.attr("placeholder",d),y.val(""),$("#editorDialog").find("#editorDialog-title").text(a),$("#editorDialog").find(".modal-body p").text(b),$("#editorDialog").find(".modal-body i").removeClass().addClass(c),$("#editorDialog").modal({keyboard:!0})}var d=com.zybuluo.mdeditor.unifiedEditor,e=com.zybuluo.mdeditor.scrollLink,f=com.zybuluo.mdeditor.fileManager,g=com.zybuluo.mdeditor.initData,h=com.zybuluo.mdeditor.mode,i=com.zybuluo.mdeditor.common.applyPreviewElementTheme,j=com.zybuluo.common.popupConfirm,k=com.zybuluo.mdeditor.toc,l="local-offline-note-"+g.currentId,m=Markdown.getSanitizingConverter();Markdown.Extra.init(m,{extensions:["tables","fenced_code_gfm","def_list","attr_list","footnotes","smartypants","strikethrough","newlines"],highlighter:"prettify"});var n,o={strings:Markdown.local.zh};n=window.lightMode?new Markdown.EditorLight(m,null,o):new Markdown.Editor(m,null,o),e.onEditorConfigure(n),e.onLayoutCreated(),bindMathJaxHooks(m);var p=/((\n|^)(标签|tags)(.*?)(:|：)[^\S\n]*(\S*.*?)(\n|$))/i,q=[],r=!1,s=null,t=!1,u=!0;m.hooks.chain("preConversion",function(c){if(a){var d=[],e=function(a,b,c,e,f,g,h,i){if(f.length>10)return b;var j="",k=h.trim().split(" ");for(var l in k){var m=k[l].trim();if(""!==m&&(j=j+"`"+m+"` ",-1===d.indexOf(m)&&d.push(m),"4"===l))break}return j=""===j?"` `":j.substring(0,j.length-1),c+j+i},f=c.replace(p,e);0===d.length&&(d=["未分类"]);var g=b(d);return v(g===!0||t===!0?d:[]),f}return v([]),c});var v=function(b){if("True"==g.isEditablePage){var c=d.getValue(),e=$.localStorage("local-temp");if(c!=e||u===!0){$.localStorage("local-temp",c),$("#wmd-editor-save-button").show(),$("#wmd-editor-save-button > span").text(" 保存中...");var h=null;u===!0?(u=!1,h={tags:JSON.stringify(b),id:g.currentId,version_id:g.currentVersionId}):h={details:c,tags:JSON.stringify(b),id:g.currentId,version_id:g.currentVersionId},$.post(g.updateUserNoteUrl,h,function(b){b.loggedin===!1?window.location=g.loginComeFromUrl:b.id&&b.version_id?(a?(f.reset_file_public_changes(b.id,b.is_public,b.updated_date,b.version_id),$("ul#file-list span.whiter-on-black").text(b.title)):(g.currentId=String(b.id),g.currentVersionId=String(b.version_id)),$.localStorage(l)&&$.localStorage(l,null),t=!1,$("#wmd-editor-save-button > span").text("已保存"),$("#wmd-editor-save-button").delay(3e3).fadeOut()):b.version_error===!0&&b.version_id?(g.currentVersionId=String(b.version_id),$("#wmd-editor-save-button > span").html('<span class="red-on-black">保存失败</span>')):b.error&&$("#wmd-editor-save-button > span").html('<a class="red-on-black" href="javascript:window.location.reload();void 0;">保存失败</a>')},"json").fail(function(){$("#wmd-editor-save-button > span").text("离线模式"),$.localStorage(l,c),t=!0})}}else"True"==g.isUrlMode?($("#wmd-editor-save-button").show(),$("#wmd-editor-save-button > span").text("只读模式")):($("#wmd-editor-save-button > span").text("登录后保存"),$("#wmd-editor-save-button").show().delay(3e3).fadeOut())},w=!0,x=$("#wmd-preview");n.hooks.chain("onPreviewRefresh",function(){function b(){++c===d&&(e.onPreviewFinished(),a&&h.fillUpFullReaderMode(),$('#wmd-preview a:not([href^="#"])').each(function(){$(this).attr("target","_blank")}),h.closeArticleLoadingAlert())}k.renderToc(),$(".prettyprint").each(function(){$(this).addClass("linenums")}),prettyPrint(),i(null),w===!0&&(w=!1,e.onPreviewFinished());var c=0,d=2;h.openArticleLoadingAlert(a),x.waitForImages(b),MathJax.Hub.Queue(["Typeset",MathJax.Hub,"wmd-preview"]),MathJax.Hub.Queue(b)});var y=$("#editorDialog").find(".modal-body input"),z=$("#editorDialog-confirm");y.on("keydown",function(a){var b=a.charCode||a.keyCode;switch(b){case 13:z.click()}}),n.hooks.set("insertLinkDialog",function(a){return c("链接","请输入链接地址","icon-link icon-2x",'http://example.com/ "可选标题"'),A=a,!0});var A=null;n.hooks.set("insertImageDialog",function(a){return c("图片","请输入图片地址","icon-picture icon-2x",'http://example.com/images/diagram.jpg "可选标题"'),A=a,!0}),$("#editorDialog").on("hidden",function(){if(A){var a=z.data("url");a?(z.removeData("url"),A(a)):A(null)}}),z.click(function(){var a=y.val();a&&$(this).data("url",a),$("#editorDialog").modal("hide")}),$("#editorDialog").on("shown",function(){y.focus()});var B=null,C=function(a){var b=_.debounce(a,500);return function(){null===B?(a(),B=""):b()}},D=d.getValue();if(window.lightMode?(n.run(C),n.undoManager.reinit(D,0,0,0)):n.run(d.getEditor(),C),"True"==g.isEditablePage){$.localStorage("local-temp",D);var E=$.localStorage(l);E&&(E===D?$.localStorage(l,null):j("副本提醒","在网络服务中断期间，我们在离线模式下为您保存了一份文稿【<strong>"+g.currentTitle+'</strong>】的本地副本，点击<strong>【确认】</strong>使用这份副本替换云端的版本，点击<strong>【取消】</strong>继续使用云端的版本<br><br><textarea style="width: 100%; height: 280px;" spellcheck="false" autocomplete="off">'+E+"</textarea>",function(){$("#notification").modal("hide"),d.setValue(E),n.refreshPreview(),$.localStorage(l,null)},function(){$.localStorage(l,null)}))}return $("#wmd-bold-button > span").addClass("icon-bold muted"),$("#wmd-italic-button > span").addClass("icon-italic muted"),$("#wmd-link-button > span").addClass("icon-link muted"),$("#wmd-quote-button > span").addClass("icon-quote-left muted"),$("#wmd-code-button > span").addClass("icon-code muted"),$("#wmd-image-button > span").addClass("icon-picture muted"),$("#wmd-olist-button > span").addClass("icon-list-ol muted"),$("#wmd-ulist-button > span").addClass("icon-list-ul muted"),$("#wmd-heading-button > span").addClass("icon-list-alt muted"),$("#wmd-hr-button > span").addClass("icon-minus muted"),$("#wmd-undo-button > span").addClass("icon-reply muted"),$("#wmd-redo-button > span").addClass("icon-share-alt muted"),$("#wmd-bold-button").before('<li class="wmd-spacer"></li>'),$("#wmd-redo-button").after('<li id="wmd-editor-save-button" class="wmd-button" title="自动保存" style="width: 70px;"><span style="width: 70px; color: #777; font-size: 14px;"></span></li>'),$("#wmd-editor-save-button").css("margin-left","50px"),$("#wmd-editor-small-button").hide(),$("#wmd-editor-save-button").hide(),n},$(function(){function a(){f.switchPublishButton("True"==g.isPublic),$(window).unbind("resize"),$(window).resize(function(){b(),e.buildSections()}),$(window).resize(),c.focus()}function b(){var a=$(window).height()-$(".preview-container").position().top-20;c.getWmdInput().height(a),window.lightMode||c.getEditor().resize(),$(".preview-container").height(a),$("#wmd-preview").height("auto"),$(".in-page-preview-buttons").css("margin-left",$("#preview-column").width()-235),window.lightMode?$(".in-page-editor-buttons").css("margin-left",$("#editor-column").width()-170):$(".in-page-editor-buttons").css("margin-left",$("#editor-column").width()-200),m()
}var c=com.zybuluo.mdeditor.unifiedEditor;com.zybuluo.mdeditor.init(!0);var d=com.zybuluo.mdeditor.common.getCurrentMode,e=com.zybuluo.mdeditor.scrollLink,f=com.zybuluo.mdeditor.fileManager,g=com.zybuluo.mdeditor.initData,h=com.zybuluo.mdeditor.mode,i=com.zybuluo.mdeditor.common.buttonBinding,j=com.zybuluo.mdeditor.common.initialHiddenSideToolBar,k=h.initialHiddenTopToolBar,l=h.exchangeEditorPreview,m=com.zybuluo.mdeditor.common.resetMaxHeightOfFileList;i(".wmd-button > span","#F9F9F5","#BBBBBB"),i(".preview-button > span","#F9F9F5","#BBBBBB"),$("a#signup, a#login").on("click",function(){window.location=$(this).attr("href")}),window.lightMode||$("#wmd-search-replace-button").on("click",function(){c.searchEditor(!0)}),$("#wmd-help-button").on("click",function(){window.open(g.markdownHelpUrl)});var n=function(){k.hideToolBar(),k.isHidden()?($("#wmd-hidden-menu-button span").removeClass("icon-chevron-sign-up").addClass("icon-chevron-sign-down"),$("#wmd-hidden-menu-button").attr("title","显示工具栏")):($("#wmd-hidden-menu-button span").removeClass("icon-chevron-sign-down").addClass("icon-chevron-sign-up"),$("#wmd-hidden-menu-button").attr("title","隐藏工具栏")),$(window).resize()};$("#wmd-hidden-menu-button").on("click",n),l.loadDefault(),$("#editor-reader-exchange-button").on("click",function(){l.exchange()}),$("#preview-info-button").on("show",function(){com.zybuluo.mdeditor.common.caculateAndFillPreviewCharacters()}),$("ul#file-list li a").on("click",function(a){a.preventDefault();var b=$(this).attr("href");window.location="-1"==g.currentId?b:d().isEditorReader?b:b+window.location.hash}),$("#preview-new-button").on("click",function(){f.newFile()}),$("#preview-delete-button").on("click",function(){f.deleteFile()}),$("#download-markdown-submenu").on("click",function(){f.downloadFile("markdown",c.getValue())}),$("#download-html-submenu").on("click",function(){f.downloadFile("html",null)}),$("#preview-publish-button").on("click",f.publishFile),$("#publish-updated-submenu").on("click",function(a){a.preventDefault(),f.republishFile()}),$(".fixed-link-submenu").each(function(){$(this).on("click",function(a){a.preventDefault(),window.open(g.userNoteUrl)})}),$("#revert-publish-submenu").on("click",function(a){a.preventDefault(),f.publishedFile()}),f.switchPublishButton("True"==g.isPublic),com.zybuluo.mdeditor.common.loadSiteTheme(c);var o=com.zybuluo.mdeditor.common.switchSiteTheme;if($("#preview-theme-button").on("click",function(){o(c)}),!window.lightMode){var p=$("#mode-normal-submenu > span"),q=$("#mode-vim-submenu > span"),r=$("#mode-emacs-submenu > span"),s=function(a){c.applyMode(a),p.removeClass("blue-on-black"),q.removeClass("blue-on-black"),r.removeClass("blue-on-black"),"vim"===a?q.addClass("blue-on-black"):"emacs"===a?r.addClass("blue-on-black"):p.addClass("blue-on-black"),$.localStorage("editorMode",a)};$("#mode-normal-submenu").on("click",function(){s("")}),$("#mode-vim-submenu").on("click",function(){s("vim")}),$("#mode-emacs-submenu").on("click",function(){s("emacs")});var t=$.localStorage("editorMode");t||(t=""),s(t)}com.zybuluo.mdeditor.common.bindingFullScreenApi("#preview-fullscreen-button");var u=com.zybuluo.common.browserType,v="keydown";(u.isOpera||u.isFirefox)&&(v="keypress"),$(document).on(v,function(b){if((b.ctrlKey||b.metaKey)&&!b.shiftKey){var e=d(),i=b.charCode||b.keyCode,k=String.fromCharCode(i).toLowerCase();switch(k){case"m":if(b.altKey){if(e.isEditorReader){h.switchFullReaderMode();break}if(e.isFullReader){h.switchNormalModeFromFullReaderMode(a);break}if(e.isFullEditor){h.switchNormalModeFromFullEditorMode(a),h.switchFullReaderMode();break}}else{if(e.isEditorReader){h.switchFullEditorMode();break}if(e.isFullEditor){h.switchNormalModeFromFullEditorMode(a);break}if(e.isFullReader){h.switchNormalModeFromFullReaderMode(a),h.switchFullEditorMode();break}}return;case"j":if(b.altKey){o(c);break}return;case"h":if(b.altKey){window.open(g.markdownHelpUrl);break}return;case"n":if(b.altKey&&e.isEditorReader){f.newFile();break}return;case"d":if(b.altKey&&e.isEditorReader){f.deleteFile();break}return;case"p":if(b.altKey&&e.isEditorReader){if("True"==g.isPublic){f.republishFile();break}f.publishFile();break}return;case"f":if(b.altKey&&!e.isFullEditor){$("#preview-list-button > span").dropdown("toggle");break}return;case"o":if(b.altKey&&!e.isFullEditor){$("#preview-toc-button > span").dropdown("toggle");break}return;case"i":if(b.altKey)if(e.isEditorReader)$("#preview-info-button > span").dropdown("toggle");else if(e.isFullReader){j.hideToolBar();break}return;case"u":if(b.altKey&&!e.isFullReader){n();break}return;case"x":if(b.altKey&&e.isEditorReader){l.exchange();break}return;case"r":if(b.altKey&&e.isEditorReader){$("#preview-settings-button > span").dropdown("toggle");break}return;default:return}b.preventDefault&&b.preventDefault(),window.event&&(window.event.returnValue=!1)}}),$("#wmd-editor-full-button").on("click",h.switchFullEditorMode),$("#wmd-editor-small-button").on("click",function(){h.switchNormalModeFromFullEditorMode(a)}),$("#preview-reader-full-button").on("click",h.switchFullReaderMode),$("#preview-reader-small-button").on("click",function(){h.switchNormalModeFromFullReaderMode(a)}),$("#preview-reader-small-button").hide(),$(window).resize(function(){b(),e.buildSections()}),b();var w=0,x=c.getValue(),y=x.indexOf("\n");w=-1!=y?y:x.length;var z=c.getEditor(),A=function(){window.lightMode?z.setCursorPosition(w):(-1!=y?z.navigateLineEnd():z.navigateFileEnd(),z.focus())},B=d();B.isFullEditor?(A(),h.switchFullEditorMode()):B.isFullReader?h.switchFullReaderMode():B.isHashMode||A()});